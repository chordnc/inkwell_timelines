<% records.select {|record| record.parent_category_id == id }.each do |current_record| %>
    <div>
        <% child_records = records.select {|record| record.parent_category_id == current_record.id} %>
        <span class="nesting <% unless child_records.empty? %>collapsed<% end %>"></span>
        <span class="checkbox_with_label"><%= current_record.name %></span>
        <%= render :partial => 'inkwell_timelines/multi_selector_items', :locals => {:records => records, :id => current_record.id} unless child_records.empty? %>
    </div>
<% end %>